<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="2FA Authenticator - Generate TOTP and HOTP codes instantly.">
    <title>2FA Authenticator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%2300d4aa' d='M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z'/></svg>" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #080c10;
            --surface: #0d1117;
            --surface2: #161b22;
            --border: #21262d;
            --border2: #30363d;
            --text: #e6edf3;
            --muted: #7d8590;
            --accent: #00d4aa;
            --accent2: #00b894;
            --accent-dim: rgba(0,212,170,0.12);
            --accent-glow: rgba(0,212,170,0.25);
            --warn: #f0883e;
            --danger: #ff6b6b;
            --danger-dim: rgba(255,107,107,0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Syne', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2.5rem 1rem 4rem;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -30%;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0,212,170,0.06) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .wrap {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 420px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            animation: fadeDown 0.6s ease both;
        }

        .shield {
            width: 60px;
            height: 60px;
            margin: 0 auto 1.25rem;
            position: relative;
        }

        .shield svg {
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 0 16px var(--accent-glow));
        }

        .header h1 {
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: var(--text);
            margin-bottom: 0.3rem;
        }

        .header h1 span {
            color: var(--accent);
        }

        .header p {
            font-size: 0.8rem;
            color: var(--muted);
            font-family: 'IBM Plex Mono', monospace;
            letter-spacing: 0.04em;
        }

        .type-toggle {
            width: 100%;
            display: flex;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 1rem;
            gap: 4px;
            animation: fadeUp 0.6s 0.1s ease both;
        }

        .type-btn {
            flex: 1;
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 8px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.06em;
            cursor: pointer;
            transition: all 0.25s ease;
            background: transparent;
            color: var(--muted);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .type-btn.active {
            background: var(--accent-dim);
            color: var(--accent);
            border: 1px solid rgba(0,212,170,0.3);
            box-shadow: 0 0 16px var(--accent-dim);
        }

        .type-btn:not(.active):hover {
            background: var(--surface2);
            color: var(--text);
        }

        .card {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            animation: fadeUp 0.6s 0.15s ease both;
            transition: border-color 0.3s;
        }

        .card:focus-within {
            border-color: var(--border2);
        }

        .field-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.68rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            color: var(--muted);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            display: block;
        }

        .input-wrap {
            position: relative;
            margin-bottom: 1rem;
        }

        .input-wrap input {
            width: 100%;
            padding: 0.8rem 2.75rem 0.8rem 1rem;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.875rem;
            letter-spacing: 0.04em;
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
        }

        .input-wrap input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }

        .input-wrap input::placeholder {
            color: var(--border2);
            font-family: 'IBM Plex Mono', monospace;
        }

        .clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            padding: 5px;
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-size: 0.8rem;
            transition: color 0.2s;
        }

        .clear-btn:hover { color: var(--text); }

        .hotp-fields {
            display: none;
            animation: fadeUp 0.3s ease both;
        }

        .hotp-fields.show { display: block; }

        .counter-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            align-items: stretch;
        }

        .counter-row input[type="number"] {
            flex: 1;
            padding: 0.8rem 1rem;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
            -moz-appearance: textfield;
        }

        .counter-row input[type="number"]::-webkit-inner-spin-button,
        .counter-row input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }

        .counter-row input[type="number"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }

        .counter-btns {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .counter-btns button {
            width: 34px;
            flex: 1;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--muted);
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .counter-btns button:hover {
            background: var(--accent-dim);
            border-color: rgba(0,212,170,0.3);
            color: var(--accent);
        }

        .btn-gen {
            width: 100%;
            padding: 0.85rem;
            background: var(--accent);
            color: #080c10;
            border: none;
            border-radius: 10px;
            font-family: 'Syne', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 0.04em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-gen:hover {
            background: var(--accent2);
            box-shadow: 0 4px 20px var(--accent-glow);
            transform: translateY(-1px);
        }

        .btn-gen:active { transform: translateY(0); }
        .btn-gen:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

        .err {
            margin-top: 0.75rem;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            color: var(--danger);
            display: none;
            padding: 0.5rem 0.75rem;
            background: var(--danger-dim);
            border-radius: 6px;
            border: 1px solid rgba(255,107,107,0.2);
        }

        .err.show { display: block; }

        .result-card {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: none;
            animation: fadeUp 0.4s ease both;
        }

        .result-card.show { display: block; }

        .result-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .result-type-tag {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.68rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            color: var(--accent);
            text-transform: uppercase;
            background: var(--accent-dim);
            border: 1px solid rgba(0,212,170,0.2);
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
        }

        .timer-pill {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--surface2);
            border: 1px solid var(--border);
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
        }

        .pulse-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--accent);
            flex-shrink: 0;
            animation: blink 1.2s ease-in-out infinite;
        }

        .pulse-dot.hot {
            background: var(--danger);
            animation: none;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.25; }
        }

        .timer-pill span {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            color: var(--muted);
        }

        .timer-pill span b {
            color: var(--text);
        }

        .counter-pill {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: var(--surface2);
            border: 1px solid var(--border);
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
        }

        .counter-pill span {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            color: var(--muted);
        }

        .counter-pill span b {
            color: var(--accent);
        }

        .otp-display {
            text-align: center;
            margin-bottom: 1.25rem;
            position: relative;
        }

        .otp-code {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 3.25rem;
            font-weight: 600;
            letter-spacing: 0.3em;
            color: var(--accent);
            line-height: 1;
            transition: color 0.3s, text-shadow 0.3s;
            text-shadow: 0 0 30px var(--accent-glow);
        }

        .otp-code.hot {
            color: var(--danger);
            text-shadow: 0 0 30px rgba(255,107,107,0.3);
        }

        .otp-sep {
            display: inline-block;
            width: 0.3em;
        }

        .progress-track {
            height: 3px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1.25rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            transition: width 1s linear, background 0.3s;
        }

        .progress-fill.hot { background: var(--danger); }

        .btn-copy {
            width: 100%;
            padding: 0.75rem;
            background: transparent;
            color: var(--muted);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'Syne', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-copy:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-dim);
        }

        .btn-copy.copied {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-dim);
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(2rem);
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border2);
            padding: 0.7rem 1.25rem;
            border-radius: 10px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.8rem;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            white-space: nowrap;
            z-index: 999;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        footer {
            margin-top: auto;
            padding-top: 2rem;
            text-align: center;
            color: var(--muted);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.72rem;
            letter-spacing: 0.04em;
            animation: fadeUp 0.6s 0.3s ease both;
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        footer a:hover { color: var(--accent2); }

        @keyframes fadeDown {
            from { opacity: 0; transform: translateY(-16px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(16px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="wrap">

    <div class="header">
        <div class="shield">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L4 6V12C4 16.42 7.45 20.6 12 22C16.55 20.6 20 16.42 20 12V6L12 2Z" fill="rgba(0,212,170,0.15)" stroke="#00d4aa" stroke-width="1.5" stroke-linejoin="round"/>
                <path d="M9 12L11 14L15 10" stroke="#00d4aa" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        
        <h1>2FA <span>Auth</span></h1>
        <p>// one-time password generator</p>
    </div>

    <div class="type-toggle">
        <button class="type-btn active" id="btnTOTP" onclick="switchType('totp')">
            <i class="fas fa-clock"></i> TOTP
        </button>
        
        <button class="type-btn" id="btnHOTP" onclick="switchType('hotp')">
            <i class="fas fa-hashtag"></i> HOTP
        </button>
    </div>

    <div class="card">
        <label class="field-label">Secret Key</label>
        <div class="input-wrap">
            <input type="text" id="secretInput" placeholder="JBSWY3DPEHPK3PXP" autocomplete="off" spellcheck="false">
            <button type="button" id="clearBtn" class="clear-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="hotp-fields" id="hotpFields">
            <label class="field-label">Counter</label>
            <div class="counter-row">
                <input type="number" id="counterInput" value="0" min="0" placeholder="0">
                <div class="counter-btns">
                    <button type="button" onclick="adjCounter(1)"><i class="fas fa-plus"></i></button>
                    <button type="button" onclick="adjCounter(-1)"><i class="fas fa-minus"></i></button>
                </div>
            </div>
        </div>

        <button class="btn-gen" id="genBtn">
            <i class="fas fa-key"></i> Generate Code
        </button>
        <div class="err" id="errMsg"></div>
    </div>

    <div class="result-card" id="resultCard">
        <div class="result-meta">
            <div class="result-type-tag" id="resultTag">TOTP</div>
            <div class="timer-pill" id="timerPill">
                <div class="pulse-dot" id="pulseDot"></div>
                <span>in <b id="timerSec">30</b>s</span>
            </div>
            
            <div class="counter-pill" id="counterPill" style="display:none;">
                <i class="fas fa-hashtag" style="font-size:0.65rem;color:var(--muted)"></i>
                <span>counter <b id="counterDisp">0</b></span>
            </div>
        </div>

        <div class="otp-display">
            <div class="otp-code" id="otpCode">000 000</div>
        </div>

        <div class="progress-track" id="progTrack">
            <div class="progress-fill" id="progFill"></div>
        </div>

        <button class="btn-copy" id="copyBtn">
            <i class="fas fa-copy"></i> Copy Code
        </button>
    </div>

    <footer>
        <p>Powered by <a href="https://github.com/Ridwanzanphelibelll/Auth2FA" target="_blank">RSCoders</a> &copy; <span id="yr"></span></p>
    </footer>

</div>

<div class="toast" id="toast"></div>

<script>
    document.getElementById('yr').textContent = new Date().getFullYear();

    let activeSecret = '';
    let activeType = 'totp';
    let ticker = null;

    const secretInput = document.getElementById('secretInput');
    const clearBtn = document.getElementById('clearBtn');

    secretInput.addEventListener('input', () => {
        clearBtn.style.display = secretInput.value.trim() ? 'flex' : 'none';
    });

    clearBtn.addEventListener('click', () => {
        secretInput.value = '';
        clearBtn.style.display = 'none';
        document.getElementById('errMsg').classList.remove('show');
        document.getElementById('resultCard').classList.remove('show');
        activeSecret = '';
        if (ticker) clearInterval(ticker);
        secretInput.focus();
    });

    function switchType(t) {
        activeType = t;
        document.getElementById('btnTOTP').classList.toggle('active', t === 'totp');
        document.getElementById('btnHOTP').classList.toggle('active', t === 'hotp');
        document.getElementById('hotpFields').classList.toggle('show', t === 'hotp');
        document.getElementById('resultCard').classList.remove('show');
        document.getElementById('errMsg').classList.remove('show');
        activeSecret = '';
        if (ticker) clearInterval(ticker);
    }

    function adjCounter(d) {
        const inp = document.getElementById('counterInput');
        inp.value = Math.max(0, (parseInt(inp.value) || 0) + d);
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
    }

    function fmtToken(tok) {
        if (!tok || tok.length !== 6) return tok;
        return tok.slice(0, 3) + ' ' + tok.slice(3);
    }

    async function generate() {
        const secret = secretInput.value.trim();
        const errEl = document.getElementById('errMsg');
        const btn = document.getElementById('genBtn');
        errEl.classList.remove('show');

        if (!secret) {
            errEl.textContent = 'Secret key is required.';
            errEl.classList.add('show');
            return;
        }

        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';

        try {
            if (activeType === 'totp') {
                const res = await fetch('/api/totp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ secret })
                });
                const data = await res.json();
                if (!data.status) {
                    errEl.textContent = data.message;
                    errEl.classList.add('show');
                    return;
                }
                activeSecret = secret;
                renderTOTP(data.data);
                document.getElementById('timerPill').style.display = 'flex';
                document.getElementById('counterPill').style.display = 'none';
                document.getElementById('progTrack').style.display = 'block';
                document.getElementById('resultTag').textContent = 'TOTP';
                document.getElementById('resultCard').classList.add('show');
                startTicker();
            } else {
                const counter = parseInt(document.getElementById('counterInput').value) || 0;
                const res = await fetch('/api/hotp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ secret, counter })
                });
                const data = await res.json();
                if (!data.status) {
                    errEl.textContent = data.message;
                    errEl.classList.add('show');
                    return;
                }
                if (ticker) clearInterval(ticker);
                activeSecret = '';
                renderHOTP(data.data);
                document.getElementById('timerPill').style.display = 'none';
                document.getElementById('counterPill').style.display = 'flex';
                document.getElementById('progTrack').style.display = 'none';
                document.getElementById('resultTag').textContent = 'HOTP';
                document.getElementById('resultCard').classList.add('show');
            }
        } catch (e) {
            errEl.textContent = 'Network error. Please try again.';
            errEl.classList.add('show');
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-key"></i> Generate Code';
        }
    }

    function renderTOTP({ token, timeRemaining, period }) {
        const code = document.getElementById('otpCode');
        const sec = document.getElementById('timerSec');
        const fill = document.getElementById('progFill');
        const dot = document.getElementById('pulseDot');
        const hot = timeRemaining <= 5;

        code.textContent = fmtToken(token);
        code.classList.toggle('hot', hot);
        sec.textContent = timeRemaining;
        fill.style.width = ((timeRemaining / period) * 100) + '%';
        fill.classList.toggle('hot', hot);
        dot.classList.toggle('hot', hot);
    }

    function renderHOTP({ token, counter }) {
        const code = document.getElementById('otpCode');
        code.classList.remove('hot');
        code.textContent = fmtToken(token);
        document.getElementById('counterDisp').textContent = counter;
    }

    function startTicker() {
        if (ticker) clearInterval(ticker);
        ticker = setInterval(async () => {
            if (!activeSecret) return;
            try {
                const res = await fetch('/api/totp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ secret: activeSecret })
                });
                const data = await res.json();
                if (data.status) renderTOTP(data.data);
            } catch (e) {}
        }, 1000);
    }

    async function copyCode() {
        const raw = document.getElementById('otpCode').textContent.replace(/\s/g, '');
        try {
            await navigator.clipboard.writeText(raw);
            const btn = document.getElementById('copyBtn');
            btn.classList.add('copied');
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            showToast('Code copied!');
            setTimeout(() => {
                btn.classList.remove('copied');
                btn.innerHTML = '<i class="fas fa-copy"></i> Copy Code';
            }, 1800);
        } catch (e) {
            showToast('Failed to copy.');
        }
    }

    document.getElementById('genBtn').addEventListener('click', generate);
    document.getElementById('copyBtn').addEventListener('click', copyCode);
    secretInput.addEventListener('keydown', e => { if (e.key === 'Enter') generate(); });
    document.getElementById('counterInput').addEventListener('keydown', e => { if (e.key === 'Enter') generate(); });
</script>

</body>
</html>
